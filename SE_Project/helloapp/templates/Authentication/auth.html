<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication</title>
    <style>
        .hidden { display: none; }
        .auth-container { max-width: 300px; margin: 50px auto; font-family: sans-serif; }
        .toggle-btn { color: blue; text-decoration: underline; cursor: pointer; }
        .messages { color: red; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="auth-container">
    <h2 id="form-title">Login</h2>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <form id="auth-form" method="POST" action="{% url 'login' %}">
        {% csrf_token %}

        <label>Username:</label><br>
        <input type="text" name="username" required><br><br>

        <div id="signup-fields" class="hidden">
            <label>Email:</label><br>
            <input type="email" name="email" id="email-field"><br><br>
        </div>

        <label>Password:</label><br>
        <input type="password" name="password1" required><br><br>

        <div id="confirm-password-field" class="hidden">
            <label>Confirm Password:</label><br>
            <input type="password" name="password2" id="password2-field"><br><br>
        </div>

        <button type="submit" id="submit-btn">Login</button>
    </form>

    <p id="toggle-text" style="margin-top: 20px;">
        Don't have an account? <span class="toggle-btn" onclick="toggleAuth()">Sign Up</span>
    </p>
</div>

<script>
    let isLogin = true;

    function toggleAuth() {
        isLogin = !isLogin;

        const form = document.getElementById('auth-form');
        const title = document.getElementById('form-title');
        const submitBtn = document.getElementById('submit-btn');
        const toggleText = document.getElementById('toggle-text');
        const signupFields = document.getElementById('signup-fields');
        const confirmField = document.getElementById('confirm-password-field');

        if (isLogin) {
            title.innerText = "Login";
            submitBtn.innerText = "Login";
            form.action = "{% url 'login' %}";
            toggleText.innerHTML = 'Don\'t have an account? <span class="toggle-btn" onclick="toggleAuth()">Sign Up</span>';
            signupFields.classList.add('hidden');
            confirmField.classList.add('hidden');
            document.getElementById('email-field').required = false;
            document.getElementById('password2-field').required = false;
        } else {
            title.innerText = "Sign Up";
            submitBtn.innerText = "Sign Up";
            form.action = "{% url 'signup' %}";
            toggleText.innerHTML = 'Already have an account? <span class="toggle-btn" onclick="toggleAuth()">Login</span>';
            signupFields.classList.remove('hidden');
            confirmField.classList.remove('hidden');
            // Add required attribute for signup validation
            document.getElementById('email-field').required = true;
            document.getElementById('password2-field').required = true;
        }
    }
</script>

</body>
</html>