<!DOCTYPE html>
<html>
<head>
    <title>Verify Login - Movie Night</title>
    <style>
        body { background-color: #fce4ec; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .auth-container { max-width: 400px; background-color: #FFB6C1; padding: 40px; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); text-align: center; }
        .auth-title { color: #880e4f; margin-bottom: 10px; }
        .auth-card { background: white; padding: 30px; border-radius: 12px; color: #555; }
        .spinner { font-size: 3em; margin: 20px; color: #c2185b; animation: spin 2s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #status-msg { font-weight: bold; color: #c2185b; margin-top: 10px; }
    </style>
</head>
<body>

<div class="auth-container">
    <h1 class="auth-title">Check your Email üìß</h1>
    <div class="auth-card">
        <p>We sent a verification link to your inbox.</p>
        <p>Please click <strong>YES</strong> to continue.</p>
        <div class="spinner">üçø</div>
        <div id="status-msg">Waiting for confirmation...</div>
    </div>
</div>

<script>
    const statusMsg = document.getElementById("status-msg");
    const interval = setInterval(() => {
        fetch("{% url 'check_status' %}")
        .then(res => res.json())
        .then(data => {
            if (data.status === 'approved') {
                statusMsg.innerText = "Success! Redirecting...";
                clearInterval(interval);
                window.location.href = "{% url 'main' %}";
            }
            else if (data.status === 'onboarding') {
                window.location.href = "{% url 'select_genres' %}";
            }
            else if (data.status === 'denied') {
                statusMsg.innerText = "Login Denied.";
                clearInterval(interval);
                alert("You denied the request.");
                window.location.href = "{% url 'login' %}";
            }
        })
        .catch(error => console.error('Error:', error));
    }, 2000);
</script>
</body>
</html>